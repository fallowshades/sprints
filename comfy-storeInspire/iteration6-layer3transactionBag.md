# (1) Access derived state

## Challenge (32) - Setup RTK and react-toastify

- create features/cart/cartSlice.js
- setup default state (README) and reducers
- export actions and cartSlice.reducer
- create store.js and add cartSlice
- setup RTK and react-toastify in main.jsx

## Building the `cartSlice` Redux Slice

1. **Import Required Modules**:

- Import functions from specific libraries:
  - `createSlice` from `@reduxjs/toolkit`
  - `toast` from `react-toastify`

2. **Initialize Default State**:

- Create a `defaultState` object with the following properties:
  - `cartItems` (array)
  - `numItemsInCart` (integer)
  - `cartTotal` (integer)
  - `shipping` (fixed value: 500)
  - `tax` (integer)
  - `orderTotal` (integer)

3. **Create the Redux Slice**:

- Use the `createSlice` function to create the `cartSlice`.
  - Name it as `'cart'`.
  - Use the previously created `defaultState` as the `initialState`.
  - Define several reducer functions within it:
    - `addItem`: Logs the payload when an item is added.
    - `clearCart`: Intended to clear all items from the cart.
    - `removeItem`: Intended to remove a specific item.
    - `editItem`: Intended to edit a specific item.

4. **Export Actions**:

- Destructure and export the following actions:
  - `addItem`
  - `removeItem`
  - `editItem`
  - `clearCart`

5. **Export Reducer**:

- Export the reducer generated by `cartSlice` for usage in the Redux store.

## Solution (32) - Setup RTK and react-toastify

features/cart/cartSlice.js

```js
import { createSlice } from '@reduxjs/toolkit'
import { toast } from 'react-toastify'

const defaultState = {
  cartItems: [],
  numItemsInCart: 0,
  cartTotal: 0,
  shipping: 500,
  tax: 0,
  orderTotal: 0,
}

const cartSlice = createSlice({
  name: 'cart',
  initialState: defaultState,
  reducers: {
    addItem: (state, action) => {
      console.log(action.payload)
    },
    clearCart: (state) => {},

    removeItem: (state, action) => {},
    editItem: (state, action) => {},
  },
})

export const { addItem, removeItem, editItem, clearCart } = cartSlice.actions

export default cartSlice.reducer
```

store.js

```js
import { configureStore } from '@reduxjs/toolkit'

import cartReducer from './features/cart/cartSlice'
export const store = configureStore({
  reducer: {
    cartState: cartReducer,
  },
})
```

main.jsx

```js
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import 'react-toastify/dist/ReactToastify.css'
// order
import './index.css'

import { ToastContainer } from 'react-toastify'
import { store } from './store'
import { Provider } from 'react-redux'
ReactDOM.createRoot(document.getElementById('root')).render(
  <Provider store={store}>
    <App />
    <ToastContainer position="top-center" />
  </Provider>
)
```

---

---

# (2)

## Challenge (33) - Add Product (SingleProductPage)

- import and dispatch addItem action
- add item to cart in SingleProduct page

## Solution (33) - Add Product (SingleProductPage)

SingleProduct.jsx

```js
import { useDispatch } from 'react-redux'
import { addItem } from '../features/cart/cartSlice'
const SingleProduct = () => {
  const dispatch = useDispatch()
  const cartProduct = {
    cartID: product.id + productColor,
    productID: product.id,
    image,
    title,
    price,
    amount,
    productColor,
    company,
  }

  const addToCart = () => {
    dispatch(addItem({ product: cartProduct }))
  }
  return (
    <section>
      ....
      {/* CART BUTTON */}
      <div className="mt-10 ">
        <button className="btn btn-secondary btn-md" onClick={addToCart}>
          Add to bag
        </button>
      </div>
    </section>
  )
}
```

#

## Challenge (34) - AddItem Reducer

- display cartItems in Navbar
- setup addItem functionality

## Building the `addItem` Reducer

1. **Purpose**:

- This reducer updates the cart state when a product is added.

2. **Extract Product from Action**:

- Extract the `product` object from `action.payload`.

3. **Check for Existing Item**:

- Search for the product in the `cartItems` array based on the `cartID`.
- If the item already exists in the cart:
  - Increment the `amount` of the item in the cart by the `amount` of the `product`.

4. **Add New Item**:

- If the product does not exist in the cart:
  - Push the `product` directly into the `cartItems` array.

5. **Update Cart Totals**:

- Increase the `numItemsInCart` by the `amount` of the product.
- Increase the `cartTotal` by the product's `price` multiplied by its `amount`.

6. **Calculate Tax and Order Total**:

- Set `tax` as 10% of the `cartTotal`.
- Calculate the `orderTotal` as the sum of `cartTotal`, `shipping`, and `tax`.

7. **Save to Local Storage**:

- Convert the current state to a JSON string and store it in the browser's local storage under the key 'cart'.

8. **Notify User**:

- Use the `toast.success` method to display a success message: 'Item added to cart'.

## Solution (34) - AddItem Reducer

Navbar.jsx

```js
import { useSelector } from 'react-redux'
const numItemsInCart = useSelector((state) => state.cartState.numItemsInCart)
```

cartSlice.js

```js
{
    addItem: (state, action) => {
      const { product } = action.payload;

      const item = state.cartItems.find((i) => i.cartID === product.cartID);
      if (item) {
        item.amount += product.amount;
      } else {
        state.cartItems.push(product);
      }
      state.numItemsInCart += product.amount;
      state.cartTotal += product.price * product.amount;
      state.tax = 0.1 * state.cartTotal;
      state.orderTotal = state.cartTotal + state.shipping + state.tax;
      localStorage.setItem('cart', JSON.stringify(state));
      toast.success('Item added to cart');
    },
}

```

'

#

## Challenge (35) - Refactor and Setup Local Storage

- refactor addItem and get default state from local storage

### calculateTotals Reducer:

1. **Purpose**:

- Re-calculates the tax and order total for the cart.

2. **Calculate Tax and Order Total**:

- Set `tax` as 10% of the `cartTotal`.
- Determine the `orderTotal` as the sum of `cartTotal`, `shipping`, and `tax`.

3. **Save to Local Storage**:

- Convert the current state to a JSON string and save it in the browser's local storage under the key 'cart'.

## Solution (35) - Refactor and Setup Local Storage

```js
import { createSlice } from '@reduxjs/toolkit'
import { toast } from 'react-toastify'

const defaultState = {
  cartItems: [],
  numItemsInCart: 0,
  cartTotal: 0,
  shipping: 500,
  tax: 0,
  orderTotal: 0,
}

const getCartFromLocalStorage = () => {
  return JSON.parse(localStorage.getItem('cart')) || defaultState
}

const cartSlice = createSlice({
  name: 'cart',
  initialState: getCartFromLocalStorage(),
  reducers: {
    addItem: (state, action) => {
      const { product } = action.payload

      const item = state.cartItems.find((i) => i.cartID === product.cartID)
      if (item) {
        item.amount += product.amount
      } else {
        state.cartItems.push(product)
      }
      state.numItemsInCart += product.amount
      state.cartTotal += product.price * product.amount
      cartSlice.caseReducers.calculateTotals(state)
      toast.success('item added to cart')
    },
    clearCart: (state) => {},

    removeItem: (state, action) => {},
    editItem: (state, action) => {},

    calculateTotals: (state) => {
      state.tax = 0.1 * state.cartTotal
      state.orderTotal = state.cartTotal + state.shipping + state.tax
      localStorage.setItem('cart', JSON.stringify(state))
    },
  },
})

export const { addItem, removeItem, editItem, clearCart } = cartSlice.actions

export default cartSlice.reducer
```

#

## Challenge (36) - Clear Cart, Remove Item and Edit Item

- try to setup reducers for clear cart, remove item and edit item

## Building the Reducers

### clearCart Reducer:

1. **Purpose**:

- Clears the current cart state and resets it to the default state.

2. **Update Local Storage**:

- Store the `defaultState` in the browser's local storage under the key 'cart'.

3. **Return Default State**:

- Reset the entire cart state by returning `defaultState`.

### removeItem Reducer:

1. **Purpose**:

- Removes a specific item from the cart.

2. **Extract cartID from Action**:

- Extract the `cartID` from `action.payload`.

3. **Find Product**:

- Find the product in the `cartItems` array based on the `cartID`.

4. **Update Cart Items**:

- Filter out the product from `cartItems` array based on the `cartID`.

5. **Update Cart Totals**:

- Decrease the `numItemsInCart` by the `amount` of the product.
- Decrease the `cartTotal` by the product's `price` multiplied by its `amount`.
- Call the `calculateTotals` reducer to re-evaluate tax and order total.

6. **Notify User**:

- Use the `toast.error` method to display a message: 'Item removed from cart'.

### editItem Reducer:

1. **Purpose**:

- Modifies the amount of a specific item in the cart.

2. **Extract Data from Action**:

- Extract `cartID` and `amount` from `action.payload`.

3. **Find Item**:

- Find the item in the `cartItems` array based on the `cartID`.

4. **Update Cart Totals**:

- Adjust the `numItemsInCart` by the difference between the new amount and the item's previous amount.
- Update the `cartTotal` based on the item's `price` and the amount difference.
- Update the item's `amount` to the new amount.
- Call the `calculateTotals` reducer to re-evaluate tax and order total.

5. **Notify User**:

- Use the `toast.success` method to display a message: 'Cart updated'.

## Solution (36) - Clear Cart, Remove Item and Edit Item

```js
import { createSlice } from '@reduxjs/toolkit'
import { toast } from 'react-toastify'

const defaultState = {
  cartItems: [],
  numItemsInCart: 0,
  cartTotal: 0,
  shipping: 500,
  tax: 0,
  orderTotal: 0,
}

const getCartFromLocalStorage = () => {
  return JSON.parse(localStorage.getItem('cart')) || defaultState
}

const cartSlice = createSlice({
  name: 'cart',
  initialState: getCartFromLocalStorage(),
  reducers: {
    addItem: (state, action) => {
      const { product } = action.payload

      const item = state.cartItems.find((i) => i.cartID === product.cartID)
      if (item) {
        item.amount += product.amount
      } else {
        state.cartItems.push(product)
      }
      state.numItemsInCart += product.amount
      state.cartTotal += product.price * product.amount
      cartSlice.caseReducers.calculateTotals(state)
      toast.success('item added to cart')
    },
    clearCart: (state) => {
      localStorage.setItem('cart', JSON.stringify(defaultState))
      return defaultState
    },

    removeItem: (state, action) => {
      const { cartID } = action.payload
      const product = state.cartItems.find((i) => i.cartID === cartID)
      state.cartItems = state.cartItems.filter((i) => i.cartID !== cartID)

      state.numItemsInCart -= product.amount
      state.cartTotal -= product.price * product.amount
      cartSlice.caseReducers.calculateTotals(state)
      toast.error('Item removed from cart')
    },
    editItem: (state, action) => {
      const { cartID, amount } = action.payload
      const item = state.cartItems.find((i) => i.cartID === cartID)
      state.numItemsInCart += amount - item.amount
      state.cartTotal += item.price * (amount - item.amount)
      item.amount = amount
      cartSlice.caseReducers.calculateTotals(state)
      toast.success('Cart updated')
    },

    calculateTotals: (state) => {
      state.tax = 0.1 * state.cartTotal
      state.orderTotal = state.cartTotal + state.shipping + state.tax
      localStorage.setItem('cart', JSON.stringify(state))
    },
  },
})

export const { addItem, removeItem, editItem, clearCart } = cartSlice.actions

export default cartSlice.reducer
```

```js
state.numItemsInCart += amount - item.amount
```

The logic here is to update the total number of items in the cart (state.numItemsInCart) by adjusting it based on the difference between the provided amount and the existing quantity of that item (item.amount). If amount is greater than item.amount, it means that items are being added to the cart. If amount is less than item.amount, it means that items are being removed from the cart. If they are equal, it implies no change to the quantity of that item in the cart.

The result of the subtraction (amount - item.amount) is then added to the current state.numItemsInCart to reflect the new total number of items in the cart.

```js
state.cartTotal += item.price * (amount - item.amount)
```

In this line, the logic is calculating the change in the total cost of the cart (state.cartTotal) based on the price of the item (item.price) and the change in the quantity of that item (amount - item.amount). This calculation is then added to the current state.cartTotal.

If amount is greater than item.amount, it means more items are being added, so the cost of those additional items (difference between amount and item.amount) is calculated by multiplying it with the price of the item. If amount is less than item.amount, it means items are being removed, so the cost of those removed items is subtracted from the state.cartTotal. If they are equal, there is no change in the cost related to that item.

#

## Challenge (37) - Setup Cart Page

- create CartItemsList, CartTotals, CartItem components
- export CartItemsList, CartTotals in components/index.js
- setup two column layout in cart page

### CartPage.jsx

1. **Initialize Necessary Imports**:

   - Import `useSelector` from `react-redux` to enable access to the Redux store.
   - Bring in `CartItemsList`, `SectionTitle`, and `CartTotals` components from the `components` directory.
   - Import `Link` from `react-router-dom` for navigation capabilities.

2. **Create Cart Component**:

   - Define a functional component named `Cart`.

3. **Initialize State and Variables**:

   - Set a temporary variable `user` to `null`.
   - Use the `useSelector` hook to retrieve `numItemsInCart` from the Redux store's `cartState`.

4. **Component Logic**:

   - Check if `numItemsInCart` is zero.
     - If true, return the `SectionTitle` component with the text 'Your cart is empty'.
     - If there are items in the cart, continue to display the cart details.

5. **Component Structure**:

   - Render the `SectionTitle` component with the text 'Shopping Cart'.
   - Set up a grid layout (`mt-8 grid gap-8 lg:grid-cols-12`) to manage cart layout.
   - For displaying cart items:
     - Use 8 of 12 columns on large screens (`lg:col-span-8`).
     - Insert the `CartItemsList` component.
   - For displaying cart totals and the checkout/login button:
     - Use 4 of 12 columns on large screens (`lg:col-span-4 lg:pl-4`).
     - Place the `CartTotals` component.
     - Check if `user` is defined:
       - If true, provide a link to '/checkout' with the text 'Proceed to checkout'.
       - If false, provide a link to '/login' with the text 'please login'.

6. **Export Cart Component**:

   - Export the `Cart` component as the default export of the module.

## Solution (37) - Setup Cart Page

pages/Cart.jsx

```js
import { useSelector } from 'react-redux'
import { CartItemsList, SectionTitle, CartTotals } from '../components'
import { Link } from 'react-router-dom'

const Cart = () => {
  // temp
  const user = null
  const numItemsInCart = useSelector((state) => state.cartState.numItemsInCart)
  if (numItemsInCart === 0) {
    return <SectionTitle text="Your cart is empty" />
  }
  return (
    <>
      <SectionTitle text="Shopping Cart" />
      <div className="mt-8 grid gap-8  lg:grid-cols-12">
        <div className="lg:col-span-8">
          <CartItemsList />
        </div>
        <div className="lg:col-span-4 lg:pl-4">
          <CartTotals />
          {user ? (
            <Link to="/checkout" className="btn btn-primary btn-block mt-8">
              Proceed to checkout
            </Link>
          ) : (
            <Link to="/login" className="btn btn-primary btn-block mt-8">
              please login
            </Link>
          )}
        </div>
      </div>
    </>
  )
}
export default Cart
```

#

## Challenge (38) - Cart Totals

- setup cart totals component

### CartTotals.jsx

1. **Initialize Necessary Imports**:

   - Import `useSelector` from `react-redux` for state retrieval from the Redux store.
   - Bring in `formatPrice` function from the `utils` directory for price formatting.

2. **Create CartTotals Component**:

   - Define a functional component named `CartTotals`.

3. **Retrieve State from Redux**:

   - Use the `useSelector` hook to get `cartTotal`, `shipping`, `tax`, and `orderTotal` from the Redux store's `cartState`.

4. **Component Structure**:

   - Enclose all content inside a `div` with the class `card bg-base-200`.
   - Use an inner `div` with the class `card-body` for structured content.
   - Display the Subtotal:
     - Use a `p` element with classes `flex`, `justify-between`, `text-xs`, `border-b`, and `border-base-300 pb-2`.
     - Use two nested `span` elements. The first displays "Subtotal", and the second displays the formatted `cartTotal`.
   - Display Shipping charges:
     - Similar to the Subtotal, but the text reads "Shipping" and the value is the formatted `shipping`.
   - Display Tax:
     - Similar format, but the text reads "Tax" and the value is the formatted `tax`.
   - Display Order Total:
     - Use a `p` element with classes `mt-4`, `flex`, `justify-between`, and `text-sm  pb-2`.
     - Use nested `span` elements with `font-bold` class. The first displays "Order Total", and the second displays the formatted `orderTotal`.

5. **Export CartTotals Component**:

   - Export the `CartTotals` component as the default export of the module.

## Solution (38) - Cart Totals

```js
import { useSelector } from 'react-redux'
import { formatPrice } from '../utils'
const CartTotals = () => {
  const { cartTotal, shipping, tax, orderTotal } = useSelector(
    (state) => state.cartState
  )

  return (
    <div className="card bg-base-200">
      <div className="card-body">
        {/* SUBTOTAL */}
        <p className="flex justify-between text-xs border-b border-base-300 pb-2">
          <span>Subtotal</span>
          <span className="font-medium">{formatPrice(cartTotal)}</span>
        </p>
        {/* SHIPPING */}
        <p className="flex justify-between text-xs border-b border-base-300 pb-2">
          <span>Shipping</span>
          <span className="font-medium">{formatPrice(shipping)}</span>
        </p>
        {/* Tax */}
        <p className="flex justify-between text-xs border-b border-base-300 pb-2">
          <span>Tax</span>
          <span className="font-medium">{formatPrice(tax)}</span>
        </p>
        {/* Total */}
        <p className="mt-4 flex justify-between text-sm  pb-2">
          <span className="font-bold">Order Total</span>
          <span className="font-bold">{formatPrice(orderTotal)}</span>
        </p>
      </div>
    </div>
  )
}
export default CartTotals
```

#

## Challenge (39) - Cart Items List

- iterate over cartItems and return CartItem
- in CartItem display values and implement remove,edit functionality

### CartItemsList.jsx

1. **Initialize Necessary Imports**:

   - Import `useSelector` from `react-redux` to retrieve state from the Redux store.
   - Bring in `CartItem` component for item rendering.

2. **Create CartItemsList Component**:

   - Define a functional component named `CartItemsList`.

3. **Retrieve State from Redux**:

   - Use the `useSelector` hook to get `cartItems` from the Redux store's `cartState`.

4. **Component Structure**:

   - Create a wrapping `div`.
   - Use the `map` method on `cartItems` to loop through each item.
   - For each `item`, return a `CartItem` component:
     - Pass `item.cartID` as the `key` prop for React's list rendering optimization.
     - Pass the entire `item` object as the `cartItem` prop to the `CartItem` component.

5. **Export CartItemsList Component**:

   - Export the `CartItemsList` component as the default export of the module.

### CartItem.js

1. **Initialize Necessary Imports**:

   - Import utility functions `formatPrice` and `generateAmountOptions` from the `../utils` directory.
   - Import `removeItem` and `editItem` from the Redux slice named `cartSlice`.
   - Bring in `useDispatch` from `react-redux` for dispatching actions to the Redux store.

2. **Create CartItem Component**:

   - Define a functional component named `CartItem` that accepts a `cartItem` prop.

3. **Setup Redux Dispatch**:

   - Use the `useDispatch` hook and store the result in the `dispatch` constant.

4. **Functions for Event Handlers**:

   - Define `removeItemFromTheCart` function:
     - Dispatch the `removeItem` action, passing the `cartID` from the cart item.
   - Define `handleAmount` function:
     - Dispatch the `editItem` action, updating the `amount` for the cart item identified by `cartID`.

5. **Destructure cartItem Prop**:

   - Extract necessary fields from `cartItem` including `cartID`, `title`, `price`, `image`, `amount`, `company`, and `productColor`.

6. **Component Structure**:

   - Create an `article` element wrapping the entire cart item.
     - Embed the product image using an `img` element.
     - Display product information using a `div`:
       - Show the product `title`, `company`, and `color` using corresponding elements.
     - Render the product amount using a `div` containing a dropdown `select`.
     - Provide a `button` to remove the item from the cart.
     - Display the product price using a `p` element.

7. **Export CartItem Component**:

   - Export the `CartItem` component as the default export of the module.

## Solution (39) - Cart Items List

CartItemsList.jsx

```js
import { useSelector } from 'react-redux'
import CartItem from './CartItem'
const CartItemsList = () => {
  const cartItems = useSelector((state) => state.cartState.cartItems)

  return (
    <div>
      {cartItems.map((item) => {
        return <CartItem key={item.cartID} cartItem={item} />
      })}
    </div>
  )
}
export default CartItemsList
```

CartItem.jsx

```js
import { formatPrice, generateAmountOptions } from '../utils'
import { removeItem, editItem } from '../features/cart/cartSlice'
import { useDispatch } from 'react-redux'
const CartItem = ({ cartItem }) => {
  const dispatch = useDispatch()

  const removeItemFromTheCart = () => {
    dispatch(removeItem({ cartID }))
  }
  const handleAmount = (e) => {
    dispatch(editItem({ cartID, amount: parseInt(e.target.value) }))
  }

  const { cartID, title, price, image, amount, company, productColor } =
    cartItem

  return (
    <article
      key={cartID}
      className="mb-12 flex flex-col gap-y-4 sm:flex-row flex-wrap border-b border-base-300 pb-6 last:border-b-0"
    >
      {/* IMAGE */}
      <img
        src={image}
        alt={title}
        className="h-24 w-24 rounded-lg sm:h-32 sm:w-32 object-cover"
      />
      {/* INFO */}
      <div className="sm:ml-16 sm:w-48">
        {/* TITLE */}
        <h3 className="capitalize font-medium">{title}</h3>
        {/* COMPANY */}
        <h4 className="mt-2 capitalize text-sm text-neutral-content">
          {company}
        </h4>
        {/* COLOR */}
        <p className="mt-4 text-sm capitalize flex items-center gap-x-2">
          color :
          <span
            className="badge badge-sm"
            style={{ backgroundColor: productColor }}
          ></span>
        </p>
      </div>
      <div className="sm:ml-12">
        {/* AMOUNT */}
        <div className="form-control max-w-xs">
          <label htmlFor="amount" className="label p-0">
            <span className="label-text">Amount</span>
          </label>
          <select
            name="amount"
            id="amount"
            className="mt-2 select select-base select-bordered select-xs"
            value={amount}
            onChange={handleAmount}
          >
            {generateAmountOptions(amount + 5)}
          </select>
        </div>
        {/* REMOVE */}
        <button
          className="mt-2 link link-primary link-hover text-sm"
          onClick={removeItemFromTheCart}
        >
          remove
        </button>
      </div>

      {/* PRICE */}
      <p className="font-medium sm:ml-auto">{formatPrice(price)}</p>
    </article>
  )
}
export default CartItem
```

CartItem.jsx

```js
<div className="sm:ml-12">
  {/* AMOUNT */}
  {/* REMOVE */}
</div>
```
